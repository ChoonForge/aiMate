# Development Dockerfile with Hot Reload
# Optimized for fast development iterations

FROM mcr.microsoft.com/dotnet/sdk:9.0 AS development

WORKDIR /src

# Install tools
RUN dotnet tool install --global dotnet-ef --version 9.0.0
ENV PATH="${PATH}:/root/.dotnet/tools"

# Copy solution and project files
COPY AiMate.sln ./
COPY AiMate.Core/AiMate.Core.csproj ./AiMate.Core/
COPY AiMate.Infrastructure/AiMate.Infrastructure.csproj ./AiMate.Infrastructure/
COPY AiMate.Web/AiMate.Web.csproj ./AiMate.Web/
COPY AiMate.Shared/AiMate.Shared.csproj ./AiMate.Shared/

# Restore dependencies
RUN dotnet restore

# Copy everything
COPY . .

# Create directories
RUN mkdir -p /app/uploads /app/logs && \
    chmod -R 755 /app/uploads /app/logs

WORKDIR /src/AiMate.Web

# Expose ports
EXPOSE 5000

# Run with watch for hot reload
ENTRYPOINT ["dotnet", "watch", "run", "--no-restore", "--urls", "http://+:5000"]
