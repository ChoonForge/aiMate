@using Fluxor
@using AiMate.Web.Store.Chat
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<ChatState> ChatState
@inject IDispatcher Dispatcher
@inject NavigationManager Navigation

<header class="h-14 bg-[#1A1A1A] border-b border-[#2A2A2A] flex items-center justify-between px-6">

    @* Left Side - Model Selector *@
    <div class="flex items-center gap-4">
        <div class="relative" @onclick="ToggleModelMenu">
            <button class="flex items-center gap-2 px-4 py-2 bg-[#242424] border border-[#2A2A2A] rounded-lg hover:bg-[#2A2A2A] transition-all cursor-pointer">
                <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z"/>
                    <path d="M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z"/>
                </svg>
                <span class="text-sm font-medium text-white">@SelectedModel</span>
                <svg class="w-4 h-4 text-gray-400 transition-transform @(modelMenuOpen ? "rotate-180" : "")"
                     fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </button>

            @* Model Dropdown *@
            @if (modelMenuOpen)
            {
                <div class="absolute top-full left-0 mt-2 w-56 bg-[#242424] border border-[#2A2A2A] rounded-lg shadow-2xl py-2 z-50">
                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">OpenAI</div>
                    <a @onclick="@(() => SelectModel("GPT-4"))" class="flex items-center px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition-all cursor-pointer">
                        GPT-4
                    </a>
                    <a @onclick="@(() => SelectModel("GPT-3.5 Turbo"))" class="flex items-center px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition-all cursor-pointer">
                        GPT-3.5 Turbo
                    </a>

                    <div class="h-px bg-[#2A2A2A] my-2"></div>

                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Anthropic</div>
                    <a @onclick="@(() => SelectModel("Claude 3.5 Sonnet"))" class="flex items-center px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition-all cursor-pointer">
                        Claude 3.5 Sonnet
                    </a>
                    <a @onclick="@(() => SelectModel("Claude 3 Opus"))" class="flex items-center px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition-all cursor-pointer">
                        Claude 3 Opus
                    </a>

                    <div class="h-px bg-[#2A2A2A] my-2"></div>

                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Google</div>
                    <a @onclick="@(() => SelectModel("Gemini Pro"))" class="flex items-center px-4 py-2.5 text-sm text-gray-300 hover:bg-[#2A2A2A] hover:text-white transition-all cursor-pointer">
                        Gemini Pro
                    </a>
                </div>
            }
        </div>
    </div>

    @* Right Side - New Chat Button *@
    <div class="flex items-center gap-3">
        <button @onclick="OnNewChat"
                class="flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all font-medium text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            New Chat
        </button>

        <button class="p-2 text-gray-400 hover:text-white hover:bg-[#2A2A2A] rounded-lg transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="12" cy="5" r="1"/>
                <circle cx="12" cy="19" r="1"/>
            </svg>
        </button>
    </div>
</header>

@code {
    private bool modelMenuOpen = false;
    private string SelectedModel => ChatState.Value.SelectedModel ?? "GPT-4";

    private void ToggleModelMenu()
    {
        modelMenuOpen = !modelMenuOpen;
    }

    private void SelectModel(string model)
    {
        Dispatcher.Dispatch(new SelectModelAction(model));
        modelMenuOpen = false;
    }

    private void OnNewChat()
    {
        var action = new CreateConversationAction("New Chat");
        Dispatcher.Dispatch(action);
        Navigation.NavigateTo("/");
        StateHasChanged();
    }
}
