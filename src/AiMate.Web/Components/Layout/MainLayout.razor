@using AiMate.Web.Store.Auth
@using Fluxor
@inherits LayoutComponentBase
@implements IDisposable
@inject IDispatcher Dispatcher
@inject IState<AuthState> AuthState
@inject NavigationManager Navigation

@* Clean Tailwind-based layout - No MudBlazor *@

@if (AuthState.Value.IsAuthenticated && !IsLoginPage)
{
    <div class="flex h-screen bg-[#0F0F0F] text-white overflow-hidden">
        @* Sidebar *@
        <Sidebar />

        @* Main Content Area *@
        <div class="flex-1 flex flex-col overflow-hidden">
            @* Top Bar *@
            <TopBar />

            @* Chat Container *@
            <main class="flex-1 overflow-hidden">
                @Body
            </main>
        </div>
    </div>
}
else
{
    @* Login page - full width *@
    <div class="w-full h-screen">
        @Body
    </div>
}

@code {
    private bool IsLoginPage => Navigation.Uri.Contains("/login", StringComparison.OrdinalIgnoreCase);

    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new CheckAuthAction());
        CheckAndRedirect();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);
        if (firstRender)
        {
            CheckAndRedirect();
        }
    }

    private void CheckAndRedirect()
    {
        if (!AuthState.Value.IsAuthenticated && !IsLoginPage)
        {
            Navigation.NavigateTo("/login", forceLoad: false);
        }
    }

    public void Dispose()
    {
        // Cleanup if needed
    }
}
