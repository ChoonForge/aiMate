@* Projects Tree Component *@
@using AiMate.Shared.Models
@using MudBlazor

@* <MudTreeView T="TreeItemData" Items="@TreeItems" Hover="true" Dense="true" Color="Color.Primary">
    <ItemTemplate>
        <MudTreeViewItem @bind-Expanded="@context.IsExpanded" Value="@context" Icon="@context.Icon" Text="@context.Title" 
                         EndText="@context.Count" EndTextTypo="Typo.caption" IconColor="@context.IconColor"
                         @onclick="@(() => OnItemClick(context))">
            @if (context.Children?.Any() == true)
            {
                @foreach (var child in context.Children)
                {
                    <MudTreeViewItem Value="@child" Icon="@child.Icon" Text="@child.Title" 
                                     EndText="@child.Count" IconColor="@child.IconColor"
                                     @onclick="@(() => OnItemClick(child))" />
                }
            }
        </MudTreeViewItem>
    </ItemTemplate>
</MudTreeView> *@

@code {
    [Parameter] public EventCallback<TreeItemData> OnItemSelected { get; set; }
    
    private HashSet<TreeItemData> TreeItems { get; set; } = new();

    protected override void OnInitialized()
    {
        LoadProjectTree();
    }

    private void LoadProjectTree()
    {
        // Build the project tree structure
        var projects = new List<TreeItemData>
        {
            new TreeItemData
            {
                Id = "project-1",
                Title = "Website Redesign",
                Icon = Icons.Material.Filled.FolderOpen,
                IconColor = Color.Primary,
                Type = TreeItemType.Project,
                IsExpanded = true,
                Children = new List<TreeItemData>
                {
                    new TreeItemData { Id = "conv-1-1", Title = "Homepage mockups", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation },
                    new TreeItemData { Id = "conv-1-2", Title = "Color scheme ideas", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation },
                    new TreeItemData { Id = "conv-1-3", Title = "Mobile responsiveness", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation }
                }
            },
            new TreeItemData
            {
                Id = "project-2",
                Title = "Mobile App",
                Icon = Icons.Material.Filled.FolderOpen,
                IconColor = Color.Secondary,
                Type = TreeItemType.Project,
                IsExpanded = false,
                Children = new List<TreeItemData>
                {
                    new TreeItemData { Id = "conv-2-1", Title = "Feature brainstorming", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation },
                    new TreeItemData { Id = "conv-2-2", Title = "Tech stack discussion", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation }
                }
            },
            new TreeItemData
            {
                Id = "project-3",
                Title = "Marketing Campaign",
                Icon = Icons.Material.Filled.FolderOpen,
                IconColor = Color.Tertiary,
                Type = TreeItemType.Project,
                IsExpanded = false,
                Children = new List<TreeItemData>
                {
                    new TreeItemData { Id = "conv-3-1", Title = "Social media strategy", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation },
                    new TreeItemData { Id = "conv-3-2", Title = "Email templates", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation },
                    new TreeItemData { Id = "conv-3-3", Title = "Ad copy variations", Icon = Icons.Material.Filled.Chat, Type = TreeItemType.Conversation }
                }
            }
        };

        TreeItems = projects.ToHashSet();
    }

    private async Task OnItemClick(TreeItemData item)
    {
        if (item.Type == TreeItemType.Conversation)
        {
            await OnItemSelected.InvokeAsync(item);
        }
    }
}

@* Tree Item Data Model (add to ChatModels.cs) *@
@code {
    public class TreeItemData
    {
        public string Id { get; set; } = string.Empty;
        public string Title { get; set; } = string.Empty;
        public string Icon { get; set; } = Icons.Material.Filled.Folder;
        public Color IconColor { get; set; } = Color.Default;
        public TreeItemType Type { get; set; }
        public bool IsExpanded { get; set; }
        public string? Count { get; set; }
        public List<TreeItemData>? Children { get; set; }
    }

    public enum TreeItemType
    {
        Project,
        Conversation,
        Folder
    }
}
