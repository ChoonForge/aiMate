@inject NavigationManager Navigation

<MudNavLink Href="@($"/chat/{Conversation.Id}")" 
           Match="NavLinkMatch.All"
           Icon="@Icons.Material.Filled.ChatBubble"
           Class="conversation-nav-item">
    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Style="width: 100%">
        <MudText Typo="Typo.body2" Style="@(IsActive ? "font-weight: 600" : "")">
            @TruncateTitle(Conversation.Title)
        </MudText>
        
        @if (Conversation.IsPinned || _isHovering)
        {
            <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
                <MudMenuItem Icon="@Icons.Material.Filled.Edit">Rename</MudMenuItem>
                <MudMenuItem Icon="@(Conversation.IsPinned ? Icons.Material.Filled.PushPin : Icons.Material.Outlined.PushPin)"
                            OnClick="@OnPin">
                    @(Conversation.IsPinned ? "Unpin" : "Pin")
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Archive" OnClick="@OnArchive">
                    Archive
                </MudMenuItem>
                <MudDivider />
                <MudMenuItem Icon="@Icons.Material.Filled.Delete" 
                            OnClick="@OnDelete"
                            IconColor="Color.Error">
                    <MudText Color="Color.Error">Delete</MudText>
                </MudMenuItem>
            </MudMenu>
        }
    </MudStack>
</MudNavLink>

@code {
    [Parameter, EditorRequired]
    public Conversation Conversation { get; set; } = null!;

    [Parameter]
    public bool IsActive { get; set; }

    [Parameter]
    public EventCallback OnDelete { get; set; }

    [Parameter]
    public EventCallback OnPin { get; set; }

    [Parameter]
    public EventCallback OnArchive { get; set; }

    private bool _isHovering = false;

    private string TruncateTitle(string title)
    {
        return title.Length > 28 ? title.Substring(0, 25) + "..." : title;
    }
}

<style>
    .conversation-nav-item:hover {
        background: rgba(139, 92, 246, 0.1) !important;
    }
</style>
